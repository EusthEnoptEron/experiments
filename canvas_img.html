<!doctype html>
<html>
	<head>
		<title>IMG test</title>
		<style>
		label {
			width: 100px;
			display: inline-block;
		}
		</style>
		<script src="http://code.jquery.com/jquery-latest.min.js"></script>
		<script src="libs/color.js"></script>
		<script>
		$(function() {
			var canvas = document.getElementById("canvas");
			var ctx = canvas.getContext("2d");
			var Color = net.brehaut.Color;
			var props = {
				brightness: 1,
				contrast: 1,
				hue: 1
			};

			var mouse = {x: 0, y: 0};
			var img = new Image();
			img.crossOrigin = ''; // no credentials flag.

			img.src = "http://hhhhold.com/400-550";
			$(img).on("load", function() {
				drawImage(img);
				var timeout;
				$("body").on("change", "input[type=range]", function(e) {
					clearTimeout(timeout);
					if(this.id in props) {
						props[this.id] = this.value * 1;
					}
					
					// timeout = setTimeout(drawImage.bind(null, img), 50);
					drawImage(img);
				});
			});
			
			function drawImage(img) {
				var st = new Date(), en = new Date();
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				ctx.drawImage(img, 0, 0);
				var data = ctx.getImageData(0, 0, canvas.width, canvas.height);
				
				var st = new Date();
				for(var i = 0; i < canvas.width; i++) {
					for(var j = 0; j < canvas.height; j++) {
						
						var x = i * 4;
						var y = j * 4 * canvas.width;
		
						data.data[x + y]     *= props.brightness;
						data.data[x + y + 1] *= props.brightness;
						data.data[x + y + 2] *= props.brightness;
					}
				}
				console.log(new Date() - st);
				
				ctx.putImageData(data, 0, 0);
			}
			
		});

		</script>
	</head>
	<body>
		<aside>
			<div>
				<label for="hue">Hue:</label>
				<input id="hue" type="range" value="1" min="0" max="2" step="0.01" />
			</div>
			<div>
				<label for="brightness">Brightness:</label>
				<input id="brightness" type="range" value="1" min="0" max="2" step="0.01" />
			</div>
			<div>
				<label for="contrast">Contrast:</label>
				<input id="contrast" type="range" value="1" min="0" max="2" step="0.01" />
			</div>
		</aside>

		<canvas width="800" height="300" id="canvas"></canvas>
	</body>
</html>